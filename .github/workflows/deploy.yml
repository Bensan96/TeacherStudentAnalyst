on:
push:
branches:
- main # or master
workflow_dispatch:
permissions:
contents: read
pages: write
id-token: write
concurrency:
group: "pages"
cancel-in-progress: true
jobs:
build-and-deploy:
runs-on: ubuntu-latest
steps:
- name: Checkout code
uses: actions/checkout@v4
  # CRITICAL STEP: Replace the placeholder with the secret key
  - name: Inject API Key into index.html
    run: |
      sed -i 's|\$$\$GEMINI_API_KEY\$$\$|${{ secrets.GEMINI_API_KEY }}|g' index.html

  - name: Setup Pages
    uses: actions/configure-pages@v5
    
  - name: Upload artifact
    uses: actions/upload-pages-artifact@v3
    with:
      # Upload the root directory where the index.html file is
      path: './'

  - name: Deploy to GitHub Pages
    id: deployment
    uses: actions/deploy-pages@v4
